# Руководство по тестированию

Этот документ содержит рекомендации и лучшие практики для написания тестов в проекте TimeTracker.

## Содержание

1. [Общие принципы](#общие-принципы)
2. [Утилиты для тестирования](#утилиты-для-тестирования)
3. [Тестирование компонентов](#тестирование-компонентов)
4. [Тестирование API](#тестирование-api)
5. [Использование моков](#использование-моков)
6. [Работа с асинхронным кодом](#работа-с-асинхронным-кодом)
7. [Примеры](#примеры)

## Общие принципы

1. **Изоляция тестов** - каждый тест должен быть независим от других тестов. Используйте `beforeEach` и `afterEach` для настройки и очистки состояния.

2. **Четкие описания** - названия тестов должны ясно описывать, что именно тестируется.

3. **Минимум моков** - используйте моки только когда необходимо: для имитации API, хранилища данных, таймеров и т.д.

4. **Тестируйте поведение, а не реализацию** - сосредоточьтесь на том, что компонент должен делать, а не на том, как он это делает.

5. **KISS (Keep It Simple, Stupid)** - пишите простые и понятные тесты. Избегайте сложной логики в тестах.

## Утилиты для тестирования

В проекте создан файл `src/__tests__/testUtils.ts` с общими утилитами для тестирования:

### Работа с localStorage

```typescript
// Создание и настройка мока для localStorage
const localStorageMock = setupLocalStorageMock();

// Проверка вызовов
expect(localStorageMock.setItem).toHaveBeenCalledWith('key', 'value');
```

### Рендеринг компонентов с провайдерами

```typescript
// Рендеринг компонента со всеми необходимыми провайдерами
const { container, getByText } = renderWithProviders(<YourComponent />);
```

### Работа с API

```typescript
// Настройка успешного ответа от API
const cleanup = setupFetchMock({ data: 'example' });

// Настройка ошибки от API
const cleanup = setupFetchErrorMock(404, 'Not Found');

// Не забудьте очистить моки после теста
cleanup();
```

### Создание JWT токена для тестов

```typescript
const token = createTestJWT();
```

## Тестирование компонентов

1. **Тестируйте рендеринг** - проверяйте, что компонент корректно отображается.

2. **Тестируйте взаимодействие** - проверяйте реакцию на действия пользователя (клики, ввод данных и т.д.).

3. **Тестируйте состояния** - проверяйте различные состояния компонента (загрузка, ошибка, успех).

4. **Тестируйте условный рендеринг** - проверяйте, что компонент отображает разное содержимое в зависимости от пропсов или контекста.

## Тестирование API

1. **Моки запросов** - используйте `setupFetchMock` для мокирования запросов к API.

2. **Проверка параметров запроса** - проверяйте, что запрос отправляется с правильными параметрами.

3. **Обработка ответа** - проверяйте, что ответ от API корректно обрабатывается.

4. **Обработка ошибок** - проверяйте, что ошибки от API корректно обрабатываются.

## Использование моков

1. **Локальное хранилище** - используйте `setupLocalStorageMock` для мокирования localStorage.

2. **Таймеры** - используйте `jest.useFakeTimers()` для мокирования таймеров.

3. **Навигация** - мокируйте функцию `useNavigate` из react-router-dom.

```typescript
jest.mock('react-router-dom', () => ({
  ...jest.requireActual('react-router-dom'),
  useNavigate: () => jest.fn(),
}));
```

## Работа с асинхронным кодом

1. **Использование `act()`** - оборачивайте асинхронные операции в `act()` для корректного обновления состояния компонента:

```typescript
await act(async () => {
  fireEvent.click(button);
});
```

2. **Использование `waitFor()`** - используйте `waitFor()` для ожидания изменений в DOM:

```typescript
await waitFor(() => {
  expect(screen.getByText('Загрузка завершена')).toBeInTheDocument();
});
```

3. **Использование `findBy*`** - используйте методы `findBy*` для поиска элементов, которые появляются асинхронно:

```typescript
const element = await screen.findByText('Данные загружены');
```

## Примеры

Смотрите примеры использования утилит в файле:
- `src/__tests__/components/ExampleTest.tsx`

Примеры тестов компонентов:
- `src/__tests__/Login.test.tsx`
- `src/__tests__/Register.test.tsx`
- `src/__tests__/TimeTracker.test.tsx`

Примеры тестов API:
- `src/__tests__/api/auth.test.ts`
- `src/__tests__/api/statistics.test.ts`
- `src/__tests__/api/timetracker.test.ts` 